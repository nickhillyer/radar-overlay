<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Mobile Radar</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --ios-blue: #007AFF;
            --ios-bg: rgba(255, 255, 255, 0.8);
        }

        body, html, #map { 
            height: 100%; 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            background: #000;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        
        /* Modern Floating UI Container */
        #controls {
            position: absolute; 
            bottom: 40px; /* Lifted for iOS Home Indicator */
            left: 50%; 
            transform: translateX(-50%);
            z-index: 1000; 
            background: var(--ios-bg);
            padding: 20px; 
            border-radius: 24px; 
            width: 85%; 
            max-width: 350px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15); 
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255,255,255,0.3);
            display: flex; 
            flex-direction: column; 
            gap: 15px;
        }

        .ui-row { display: flex; align-items: center; gap: 15px; }
        
        /* iOS Style Toggle Button */
        button {
            background: var(--ios-blue); 
            color: white; 
            border: none; 
            height: 44px; /* Standard iOS tap target */
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: 600; 
            flex: 1;
            font-size: 17px; 
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }
        
        button:active { 
            opacity: 0.7;
            transform: scale(0.96); 
        }

        /* Clean Modern Slider */
        input[type=range] { 
            flex: 2; 
            height: 6px; 
            -webkit-appearance: none;
            background: rgba(0,0,0,0.1);
            border-radius: 5px;
            outline: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: 0.5px solid rgba(0,0,0,0.05);
        }

        #time-display {
            font-size: 13px; 
            font-weight: 600; 
            color: #8e8e93; /* iOS Secondary Label Color */
            text-transform: uppercase;
            text-align: center; 
            letter-spacing: 1px;
        }

        /* Leaflet Attributions tweak */
        .leaflet-control-attribution {
            font-size: 8px !important;
            background: transparent !important;
        }
    </style>
</head>
<body>

    <div id="controls">
        <div id="time-display">Initializing...</div>
        <div class="ui-row">
            <button id="play-pause">Pause</button>
            <input type="range" id="slider" min="0" max="0" step="1" value="0">
        </div>
    </div>
    
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Start centered on US
        const map = L.map('map', { 
            zoomControl: false,
            attributionControl: true 
        }).setView([37.8, -96], 4);
        
        // Using a slightly more "Mobile" friendly dark-mode-ready tile set
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; CARTO'
        }).addTo(map);

        let radarLayers = [];
        let currentIndex = 0;
        let isPaused = false;
        let animationTimer;

        const timeDisplay = document.getElementById('time-display');
        const playPauseBtn = document.getElementById('play-pause');
        const slider = document.getElementById('slider');

        async function initRadar() {
            try {
                const response = await fetch('https://api.rainviewer.com/public/weather-maps.json');
                const data = await response.json();
                const frames = data.radar.past;
                const now = Math.floor(Date.now() / 1000);

                frames.forEach((frame, index) => {
                    const layer = L.tileLayer(`${data.host}${frame.path}/256/{z}/{x}/{y}/2/1_1.png`, {
                        opacity: 0,
                        zIndex: index
                    }).addTo(map);

                    const diff = Math.round((now - frame.time) / 60);
                    radarLayers.push({ 
                        layer, 
                        label: diff <= 5 ? "Live Radar" : `${diff} minutes ago` 
                    });
                });

                slider.max = radarLayers.length - 1;
                animate();
            } catch (e) {
                timeDisplay.innerText = "Radar Unavailable";
            }
        }

        function showFrame(index) {
            radarLayers.forEach((f, i) => f.layer.setOpacity(i === index ? 0.70 : 0));
            currentIndex = index;
            slider.value = index;
            timeDisplay.innerText = radarLayers[index].label;
        }

        function animate() {
            if (isPaused) return;
            showFrame(currentIndex);
            currentIndex = (currentIndex + 1) % radarLayers.length;
            animationTimer = setTimeout(animate, 600);
        }

        playPauseBtn.onclick = () => {
            isPaused = !isPaused;
            playPauseBtn.innerText = isPaused ? "Play" : "Pause";
            playPauseBtn.style.background = isPaused ? "#34C759" : "#007AFF"; // Green for play
            if (!isPaused) animate();
        };

        slider.oninput = () => {
            isPaused = true;
            playPauseBtn.innerText = "Play";
            playPauseBtn.style.background = "#34C759";
            clearTimeout(animationTimer);
            showFrame(parseInt(slider.value));
        };

        initRadar();
    </script>
</body>
</html>
